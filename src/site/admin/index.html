<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BASIK - Content Manager</title>
    <!-- Netlify Identity Widget -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  </head>
  <body>
    <!-- Decap CMS -->
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
    <script>
      // Register site styles for preview pane to match website typography
      CMS.registerPreviewStyle("/css/styles.css");

      // Custom preview template for blog posts using functional component
      const PostPreview = ({ entry, getAsset, widgetFor }) => {
        const title = entry.getIn(["data", "title"]) || "";
        const date = entry.getIn(["data", "date"]);
        const image = entry.getIn(["data", "image"]);
        const tags = entry.getIn(["data", "tags"]);

        const h = window.h;

        return h(
          "article",
          { className: "bg-white py-12" },
          h(
            "div",
            { className: "mx-auto max-w-3xl px-6" },
            h(
              "header",
              { className: "mb-10" },
              h(
                "h1",
                {
                  className:
                    "mb-4 text-4xl font-bold tracking-tight text-gray-900",
                },
                title
              ),
              date &&
                h(
                  "time",
                  { className: "text-gray-500" },
                  new Date(date).toLocaleDateString("en-GB", {
                    day: "numeric",
                    month: "long",
                    year: "numeric",
                  })
                ),
              tags &&
                tags.size > 0 &&
                h(
                  "div",
                  { className: "mt-4 flex flex-wrap gap-2" },
                  tags
                    .map(tag =>
                      h(
                        "span",
                        {
                          key: tag,
                          className:
                            "rounded-full bg-orange-100 px-3 py-1 text-sm text-orange-700",
                        },
                        tag
                      )
                    )
                    .toArray()
                )
            ),
            image &&
              h("img", {
                src: getAsset(image).toString(),
                alt: "",
                className: "mb-10 w-full rounded-lg",
              }),
            h(
              "div",
              { className: "prose prose-lg prose-orange mx-auto" },
              widgetFor("body")
            )
          )
        );
      };

      CMS.registerPreviewTemplate("blog", PostPreview);
    </script>
  </body>
</html>
